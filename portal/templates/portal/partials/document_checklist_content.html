{# portal/templates/portal/partials/document_checklist_content.html #}
{% load i18n %}
{% for item in document_status_list %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading{{ item.code }}">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ item.code }}">
        {{ item.name }}
        <span class="badge {% if item.is_uploaded %}bg-success{% else %}bg-danger{% endif %} ms-3" id="badge-{{ item.code }}">
          {% if item.is_uploaded %}
            {% blocktrans with count=item.documents|length %}Загружено ({{ count }}){% endblocktrans %}
          {% else %}
            {% translate "Требуется" %}
          {% endif %}
        </span>
      </button>
    </h2>
    <div id="collapse{{ item.code }}" class="accordion-collapse collapse" data-bs-parent="#documentAccordion">
      <div class="accordion-body">
        <ul class="list-group mb-3" id="doc-list-{{ item.code }}">
          {% for doc in item.documents %}
            {% include 'portal/partials/document_item.html' with doc=doc %}
          {% empty %}
            <li class="list-group-item text-muted no-docs-message">{% translate "Вы еще не загрузили файлы этого типа." %}</li>
          {% endfor %}
        </ul>
        <hr>
        <p class="mb-2"><strong>{% translate "Загрузить новый файл" %}:</strong></p>
        <form
          action="{% url 'portal:portal_document_upload' item.code %}"
          method="post"
          enctype="multipart/form-data"
          class="upload-form"
          data-doc-code="{{ item.code }}"
        >
          {% csrf_token %}
          <div class="row g-2 align-items-end">
            <div class="col-12 col-md-6">
              <label for="id_{{ item.code }}_file" class="form-label small text-muted mb-1">{% translate "Выберите файл" %}</label>
              <input type="file" name="file" id="id_{{ item.code }}_file" class="form-control form-control-sm" required>
            </div>
            <div class="col-12 col-md-4">
              <label for="id_{{ item.code }}_expiry" class="form-label small text-muted mb-1">{% translate "Срок действия" %}</label>
              <input
                type="date"
                name="expiry_date"
                id="id_{{ item.code }}_expiry"
                class="form-control form-control-sm"
                title="{% translate 'Срок действия (если есть)' %}"
              >
              <div class="form-text">{% translate "Оставьте пустым, если не требуется" %}</div>
            </div>
            <div class="col-12 col-md-2 text-md-end">
              <button type="submit" class="btn btn-primary btn-sm w-100">
                <span class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                <span class="button-text">{% translate "Загрузить" %}</span>
              </button>
            </div>
          </div>
          <div class="upload-feedback small mt-2" data-doc-code="{{ item.code }}"></div>
        </form>
      </div>
    </div>
  </div>
{% endfor %}