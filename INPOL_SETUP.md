# inPOL credential setup

Чтобы команда `check_inpol` могла войти в inPOL и синхронизировать статусы, нужно заранее задать учётные данные и базовый URL портала.

## Вариант 1. Локально через `.env`
Создайте файл `.env` в корне проекта и пропишите значения (без кавычек):

```
INPOL_EMAIL=you@example.com
INPOL_PASSWORD=your-password
# Например: https://inpol.mazowieckie.pl
INPOL_BASE_URL=https://inpol.example.com
```

Файл подхватывается автоматически из `legalize_site/env.py`, поэтому после этого можно запускать:

```
python manage.py check_inpol
```

## Вариант 2. Railway или другой хостинг
В панели Railway добавьте переменные окружения с теми же именами (`INPOL_EMAIL`, `INPOL_PASSWORD`, `INPOL_BASE_URL`). Процесс деплоя передаст их Django, и команда `check_inpol` будет использовать значения из окружения без дополнительной настройки. Убедитесь, что используете тот же базовый URL, который видите в браузере при ручном входе в inPOL.

## Вариант 3. Учётка inPOL в базе данных через админку
В админ-панели Django создайте запись **Учётная запись inPOL** с полями:

- «Название учётки» — свободное имя (например, "Основной бот").
- «Базовый URL inPOL» — тот же адрес, что и в браузере (например, `https://inpol.mazowieckie.pl`).
- Email и пароль для входа.
- Галочка «Активный» — должна быть включена, чтобы команда могла использовать эту запись.

Если флаги CLI и переменные окружения пусты, `check_inpol` автоматически возьмёт логин/пароль/URL из последней активной записи. Так вы сможете обновлять данные для бота прямо через админку без релиза кода.

## Ручная передача параметров
Если не хотите хранить секреты в файле или окружении, используйте флаги:

```
python manage.py check_inpol --email you@example.com --password your-password --base-url https://inpol.example.com
```

Команда не запустится, пока не получит все три значения (логин, пароль, базовый URL), поэтому держите секреты в безопасном месте и не коммитьте реальные данные в репозиторий.

## Как проверить, что всё работает
1. Выполните миграции и создайте суперпользователя (если админка ещё не настроена):
   ```
   python manage.py migrate
   python manage.py createsuperuser
   ```
2. Зайдите в `/admin/clients/inpolaccount/` и добавьте активную учётку inPOL (или заполните `.env` переменные из разделов выше).
3. Убедитесь, что есть клиенты, у которых указан номер дела или совпадающий email (по этим полям происходит сопоставление).
4. Запустите команду проверки:
   ```
   python manage.py check_inpol
   ```
   В выводе увидите либо `No changes detected.`, либо список найденных изменений вида `<номер дела>: <старый статус> -> <новый статус>` и итоговую строчку `Applied N change(s) to client records.`
5. Откройте админку клиентов — в карточках появятся поля «Номер дела в inPOL», «Статус в inPOL» и «Дата синхронизации inPOL». В разделе «Учётные записи inPOL» и «Inpol proceeding snapshots» можно посмотреть использованную учётку и сырые данные дел.
