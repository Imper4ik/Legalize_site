services:
  - type: web
    name: Legalize_site-1
    env: python
    rootDir: legalize_site
    buildCommand: |
      pip install -r ../requirements.txt
      python manage.py collectstatic --noinput
      python manage.py migrate
    startCommand: >
      bash -lc "python -c \"import os,django;os.environ.setdefault('DJANGO_SETTINGS_MODULE','legalize_site.settings');django.setup();from django.conf import settings;print('HAS DATABASE_URL=',bool(os.getenv('DATABASE_URL')));print('DB ENGINE=',settings.DATABASES['default']['ENGINE'])\" && python manage.py migrate sites --noinput && python manage.py migrate --noinput && python -c \"import os,django;os.environ.setdefault('DJANGO_SETTINGS_MODULE','legalize_site.settings');django.setup();from django.contrib.sites.models import Site;s,_=Site.objects.get_or_create(id=1);s.domain='legalize-site-1.onrender.com';s.name='legalize-site-1';s.save();print('Site set')\" && gunicorn --chdir ./legalize_site legalize_site.wsgi:application"
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.6
      - key: DJANGO_SETTINGS_MODULE
        value: legalize_site.settings
