{% extends "base.html" %}

{% block content %}
<h2>Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°: {{ client.first_name }} {{ client.last_name }}</h2>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <fieldset>
    <legend>Ð”Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°</legend>
    {{ form.as_p }}
  </fieldset>

  <fieldset>
    <legend>Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹</legend>

    {{ formset.management_form }}

    <div id="document-forms">
      {% for doc_form in formset %}
        <div class="doc-form" style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; border-radius: 10px;">
          {# Render hidden fields like id #}
          {% for hidden_field in doc_form.hidden_fields %}{{ hidden_field }}{% endfor %}
          <div>
            {{ doc_form.doc_type.label_tag }}<br>
            {{ doc_form.doc_type }}
            {{ doc_form.doc_type.errors }}
          </div>
          <div>
            {{ doc_form.file.label_tag }}<br>
            {{ doc_form.file }}
            {{ doc_form.file.errors }}
          </div>
          <div>
            {{ doc_form.is_provided.label_tag }}<br>
            {{ doc_form.is_provided }}
          </div>
          {% if doc_form.instance.pk %}
          <div>
            {{ doc_form.DELETE.label_tag }}<br>
            {{ doc_form.DELETE }}
          </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <button type="button" id="add-document-btn">âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚</button>
  </fieldset>

  <br>
  <button type="submit" style="padding: 10px 20px; font-size: 16px;">ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
</form>

{# This is the template for new forms, hidden from view. #}
<div id="empty-form-template" style="display: none;">
    <div class="doc-form" style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; border-radius: 10px;">
        {% for hidden_field in formset.empty_form.hidden_fields %}{{ hidden_field }}{% endfor %}
        <div>
            {{ formset.empty_form.doc_type.label_tag }}<br>
            {{ formset.empty_form.doc_type }}
        </div>
        <div>
            {{ formset.empty_form.file.label_tag }}<br>
            {{ formset.empty_form.file }}
        </div>
        <div>
            {{ formset.empty_form.is_provided.label_tag }}<br>
            {{ formset.empty_form.is_provided }}
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const addFormBtn = document.getElementById('add-document-btn');
    const formContainer = document.getElementById('document-forms');
    const totalFormsInput = document.getElementById('id_form-TOTAL_FORMS');
    const formTemplate = document.getElementById('empty-form-template').innerHTML;

    addFormBtn.addEventListener('click', function() {
        // Get the current number of forms
        let formNum = parseInt(totalFormsInput.value);

        // Create the new form HTML by replacing the Django prefix
        const newFormHtml = formTemplate.replace(/__prefix__/g, formNum);

        // Append the new form to the container
        formContainer.insertAdjacentHTML('beforeend', newFormHtml);

        // Increment the total forms count
        totalFormsInput.value = formNum + 1;
    });
});
</script>
{% endblock %}