{# clients/templates/clients/payment_reminder_list.html #}
{% extends "base.html" %}
{% load static i18n %}

{% block title %}{{ title|default:_("Напоминания по оплатам") }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="fas fa-dollar-sign text-success"></i>
      {{ title|default:_("Напоминания по оплатам") }} ({{ reminders_count }})
    </h2>
    <div>
      <form action="{% url 'clients:run_update_reminders' %}" method="post" class="d-inline">
        {% csrf_token %}
        {# ADDED: Hidden field to specify the redirect target #}
        <input type="hidden" name="next" value="payments">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> {% translate "Проверить и создать новые" %}
        </button>
      </form>
    </div>
  </div>

  <div class="card card-body mb-4 shadow-sm">
    <form method="get" action="" class="row g-3 align-items-end">
      <div class="col-md-4">
        <label for="client" class="form-label"><strong>{% translate "Клиент" %}</strong></label>
        <select name="client" id="client" class="form-select">
          <option value="">{% translate "Все клиенты" %}</option>
          {% for client in all_clients %}
            <option value="{{ client.id }}" {% if client_filter_id == client.id %}selected{% endif %}>{{ client }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label for="start_date" class="form-label"><strong>{% translate "Дата от" %}</strong></label>
        <input type="date" name="start_date" id="start_date" class="form-control" value="{{ filter_values.start_date|default:'' }}">
      </div>
      <div class="col-md-3">
        <label for="end_date" class="form-label"><strong>{% translate "Дата до" %}</strong></label>
        <input type="date" name="end_date" id="end_date" class="form-control" value="{{ filter_values.end_date|default:'' }}">
      </div>
      <div class="col-md-2 d-flex flex-column">
        <button type="submit" class="btn btn-info w-100">{% translate "Фильтровать" %}</button>
        <a href="{% url 'clients:payment_reminder_list' %}" class="btn btn-secondary w-100 mt-2">{% translate "Сбросить" %}</a>
      </div>
    </form>
  </div>

  <div class="list-group">
    {% for reminder in reminders %}
      {% if reminder.id %}
        {% include 'clients/partials/reminder_item.html' with reminder=reminder icon='fa-dollar-sign' %}
      {% endif %}
    {% empty %}
      <p class="text-muted">{% translate "Нет напоминаний по оплатам, соответствующих фильтрам." %}</p>
    {% endfor %}
  </div>
</div>
{% endblock %}