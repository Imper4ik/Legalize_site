{% extends "base.html" %}
{% load i18n static %}

<!-- prettier-ignore -->
{% block title %}{% blocktrans with client_name=client.first_name %}Детали клиента: {{ client_name }}{% endblocktrans %}{% endblock %}

{% block content %}
<div id="client-overview" data-refresh-url="{% url 'clients:client_overview_partial' client.pk %}">
  {% include 'clients/partials/client_overview.html' with client=client %}
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>{% translate "Финансы" %}</h4>
  <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addPaymentModal">+ {%
    translate "Добавить счёт" %}</button>
</div>
<div id="payment-alerts" class="mb-2"></div>
<div class="card mb-4">
  <ul class="list-group list-group-flush" id="payment-list-container">
    {% for payment in client.payments.all %}
    <li class="list-group-item" data-payment-id="{{ payment.id }}">
      {% include 'clients/partials/payment_item.html' with payment=payment %}
    </li>
    {% empty %}
    <li class="list-group-item text-muted" id="no-payments-message">{% translate "Счета на оплату еще не созданы." %}
    </li>
    {% endfor %}
  </ul>
</div>

<hr>

<div class="d-flex justify-content-between align-items-center">
  <h2 class="mb-0">{% translate "Чеклист документов" %}</h2>
  <div class="d-flex align-items-center ms-3 gap-2">
    <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
      data-bs-target="#sendEmailModal">
      <i class="bi bi-envelope"></i> {% translate "Отправить email" %}
    </button>
    <form id="verify-all-documents-form" action="{% url 'clients:verify_all_documents' client_id=client.pk %}"
      method="post" class="m-0">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-success btn-sm">{% translate "Проверить все загруженные" %}</button>
    </form>
  </div>
</div>

<div id="document-alerts" class="mb-2"></div>

<div class="accordion" id="documentAccordion" data-refresh-url="{% url 'clients:client_checklist_partial' client.pk %}">
  {% include 'clients/partials/document_checklist.html' with document_status_list=document_status_list client=client %}
</div>
{% endblock %}


{% block modals %}
{{ block.super }}

{% include 'clients/partials/modals.html' %}
{% endblock %}


{% block extra_js %}
{{ block.super }}
<script src="{% static 'clients/js/client_detail.js' %}" defer></script>
{% endblock %}