{# templates/clients/partials/document_checklist.html #}

{% for item in document_status_list %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading{{ item.code }}">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ item.code }}">
        {{ item.name }}
        {% if item.is_uploaded %}
          <span class="badge bg-success ms-3">{{ item.documents|length }} шт.</span>
        {% else %}
          <span class="badge bg-danger ms-3">Отсутствует</span>
        {% endif %}
      </button>
    </h2>
    <div id="collapse{{ item.code }}" class="accordion-collapse collapse" data-bs-parent="#documentAccordion">
      <div class="accordion-body">
        {% if item.is_uploaded %}
          <ul class="list-group list-group-flush mb-3">
            {% for doc in item.documents %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <a href="{{ doc.file.url }}" target="_blank">Файл от {{ doc.uploaded_at|date:"d.m.Y H:i" }}</a>
                  {% if doc.expiry_date %}<br><small class="text-danger">Действителен до: {{ doc.expiry_date|date:"d.m.Y" }}</small>{% endif %}
                  <span class="badge {% if doc.verified %}bg-success{% else %}bg-warning text-dark{% endif %} ms-2">{% if doc.verified %}Проверен{% else %}Ожидает проверки{% endif %}</span>
                </div>
                <div class="btn-group">
                  <form action="{% url 'clients:toggle_document_verification' doc.id %}" method="post" class="d-inline toggle-verification-form">{% csrf_token %}<button type="submit" class="btn btn-sm btn-outline-primary">{% if doc.verified %}Снять отметку{% else %}Проверить{% endif %}</button></form>
                  <form action="{% url 'clients:document_delete' doc.pk %}" method="post" class="d-inline delete-document-form">{% csrf_token %}<button type="submit" class="btn btn-sm btn-outline-danger">Удалить</button></form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">Документы этого типа еще не загружены.</p>
        {% endif %}
        <a href="{% url 'clients:add_document' client_id=client.id doc_type=item.code %}" class="btn btn-primary btn-sm">+ Добавить еще один файл</a>
      </div>
    </div>
  </div>
{% empty %}
  <div class="alert alert-info mx-2">
    {% if client.has_checklist_access %}
        Для цели "{{ client.get_application_purpose_display }}" на языке "{{ client.get_language_display }}" чеклист не определен в настройках.
    {% else %}
        <strong>Чеклист скрыт.</strong> Чтобы он появился, предоставьте клиенту доступ в блоке "Управление доступом" выше.
    {% endif %}
  </div>
{% endfor %}