{% load i18n %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>{{ client.first_name }} {{ client.last_name }}</h1>
  <div>
      <a href="{% url 'clients:client_print_wsc' pk=client.pk %}" class="btn btn-outline-secondary me-2">{% translate "Печать WSC" %}</a>
      <a href="{% url 'clients:client_print' pk=client.pk %}" class="btn btn-secondary me-2">{% translate "Печать" %}</a>
      <a href="{% url 'clients:client_edit' client.pk %}" class="btn btn-primary">{% translate "Редактировать данные" %}</a>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
      <p><strong>{% translate "Номер дела" %}:</strong> <span class="fs-5 text-primary"><strong>{{ client.case_number|default:_("Не указан") }}</strong></span></p>
      <p><strong>Email:</strong> {{ client.email }}</p>
      <p><strong>{% translate "Телефон" %}:</strong> {{ client.phone }}</p>
      <p><strong>{% translate "Цель подачи" %}:</strong> {{ client.get_application_purpose_display }}</p>
      <p><strong>{% translate "Основание пребывания" %}:</strong> {{ client.basis_of_stay|default:_("Не указано") }}</p>
      {% if client.legal_basis_end_date %}
          <p><strong>{% translate "Дата окончания основания" %}:</strong> <span class="fw-bold">{{ client.legal_basis_end_date|date:"d.m.Y" }}</span></p>
      {% endif %}
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-body d-flex justify-content-between align-items-start gap-3 flex-column flex-md-row">
    <div>
      <p class="mb-1"><strong>{% translate "Статус inPOL" %}:</strong> {{ client.inpol_status|default:_("Не получен") }}</p>
      {% if client.inpol_updated_at %}
        <p class="text-muted mb-1"><small>{% translate "Обновлено" %}: {{ client.inpol_updated_at|date:"d.m.Y H:i" }}</small></p>
      {% endif %}
      <p class="text-muted mb-0">
        {% blocktrans with minutes=inpol_poll_interval_minutes %}
          Автоматическая проверка каждые {{ minutes }} мин. Используется активная учётка inPOL.
        {% endblocktrans %}
      </p>
    </div>
    <form method="post" action="{% url 'clients:client_inpol_check' client.pk %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-primary">
        {% translate "Проверить статус сейчас" %}
      </button>
    </form>
  </div>
  {% if not client.case_number %}
    <div class="card-footer text-warning">
      {% translate "Добавьте номер дела, чтобы быстрее сопоставлять обновления inPOL." %}
    </div>
  {% endif %}
</div>
