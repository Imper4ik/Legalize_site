{# templates/clients/partials/modals.html #}
{% load i18n %}

<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true"
  data-price-url-template="{% url 'clients:get_price_for_service' '__service__' %}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addPaymentModalLabel">{% translate "Добавить новый счёт" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Закрыть' %}"></button>
      </div>
      <form action="{% url 'clients:add_payment' client.id %}" method="post">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="id_service_description" class="form-label">{% translate "Услуга" %}</label>
            <select name="service_description" class="form-select" id="id_service_description" required>
              {% for choice_value, choice_label in payment_form.service_description.field.choices %}
              <option value="{{ choice_value }}" {% if client.application_purpose == "work" and choice_value == "work_service" %}
                selected{% elif client.application_purpose == "study" and choice_value == "study_service" %}
                selected{% elif client.application_purpose == "family" and choice_value == "consultation" %}
                selected{% endif %}>
                {{ choice_label }}
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="id_total_amount" class="form-label">{% translate "Общая сумма" %}</label>
            <input type="number" step="0.01" name="total_amount" class="form-control" id="id_total_amount" required>
          </div>
          <div class="mb-3">
            <label for="id_amount_paid" class="form-label">{% translate "Оплачено" %}</label>
            <input type="number" step="0.01" name="amount_paid" class="form-control" id="id_amount_paid" required>
          </div>
          <div class="mb-3">
            <label for="id_due_date" class="form-label">{% translate "Дата оплаты (если есть)" %}</label>
            <input type="date" name="due_date" class="form-control" id="id_due_date">
          </div>
          <div class="mb-3">
            <label for="id_payment_date" class="form-label">{% translate "Дата фактической оплаты" %}</label>
            <input type="date" name="payment_date" class="form-control" id="id_payment_date">
          </div>
          <div class="mb-3">
            <label for="id_payment_method" class="form-label">{% translate "Способ оплаты" %}</label>
            <select name="payment_method" class="form-select" id="id_payment_method">
              <option value="">---------</option>
              {% for choice_value, choice_label in payment_form.payment_method.field.choices %}
              <option value="{{ choice_value }}">{{ choice_label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="id_transaction_id" class="form-label">{% translate "ID транзакции" %}</label>
            <input type="text" name="transaction_id" class="form-control" id="id_transaction_id">
          </div>
          <div class="mb-3">
            <label for="id_status" class="form-label">{% translate "Статус" %}</label>
            <select name="status" class="form-select" id="id_status" required>
              {% for choice_value, choice_label in payment_form.status.field.choices %}
              <option value="{{ choice_value }}">{{ choice_label }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Отмена" %}</button>
          <button type="submit" class="btn btn-primary">{% translate "Сохранить счёт" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editPaymentModal" tabindex="-1" aria-labelledby="editPaymentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editPaymentModalLabel">{% translate "Редактировать счёт" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Закрыть' %}"></button>
      </div>
      <form id="editPaymentForm" method="post">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="edit_id_service_description" class="form-label">{% translate "Услуга" %}</label>
            <select name="service_description" class="form-select" id="edit_id_service_description" required>
              {% for choice_value, choice_label in payment_form.service_description.field.choices %}
              <option value="{{ choice_value }}">{{ choice_label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label for="edit_id_total_amount" class="form-label">{% translate "Общая сумма" %}</label>
            <input type="number" step="0.01" name="total_amount" class="form-control" id="edit_id_total_amount"
              required>
          </div>
          <div class="mb-3">
            <label for="edit_id_amount_paid" class="form-label">{% translate "Оплачено" %}</label>
            <input type="number" step="0.01" name="amount_paid" class="form-control" id="edit_id_amount_paid" required>
          </div>
          <div class="mb-3">
            <label for="edit_id_due_date" class="form-label">{% translate "Дата оплаты (если есть)" %}</label>
            <input type="date" name="due_date" class="form-control" id="edit_id_due_date">
          </div>
          <div class="mb-3">
            <label for="edit_id_status" class="form-label">{% translate "Статус" %}</label>
            <select name="status" class="form-select" id="edit_id_status" required>
              {% for choice_value, choice_label in payment_form.status.field.choices %}
              <option value="{{ choice_value }}">{{ choice_label }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Отмена" %}</button>
          <button type="submit" class="btn btn-primary">{% translate "Сохранить изменения" %}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="uploadDocumentModal" tabindex="-1" aria-labelledby="uploadDocumentModalLabel"
  aria-hidden="true"
  data-action-template="{% url 'clients:add_document' client_id=client.id doc_type='__doc_type__' %}"
  data-confirm-url-template="{% url 'clients:confirm_wezwanie_parse' doc_id=0 %}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadDocumentModalLabel">{% translate "Добавить документ" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% translate 'Закрыть' %}"></button>
      </div>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="parse_wezwanie" id="uploadDocumentParseWezwanie" value="0">
        <div class="modal-body">
          <p class="mb-3 text-muted" id="uploadDocumentDescription"></p>
          <div class="mb-3">
            <label for="{{ document_upload_form.file.id_for_label }}" class="form-label">{% translate "Выберите файл"
              %}</label>
            {{ document_upload_form.file }}
          </div>
          <div class="mb-3">
            <label for="{{ document_upload_form.expiry_date.id_for_label }}" class="form-label">{% translate
              "Действителен до (необязательно)" %}</label>
            {{ document_upload_form.expiry_date }}
          </div>
          <div class="border rounded p-3 d-none" id="wezwanieConfirmationStep">
            <h6 class="mb-2">{% translate "Подтверждение данных wezwanie" %}</h6>
            <p class="text-muted mb-3">{% translate "Проверьте распознанные данные перед сохранением." %}</p>
            <dl class="row mb-3">
              <dt class="col-sm-4">{% translate "ФИО" %}</dt>
              <dd class="col-sm-8" id="wezwanieParsedFullName">—</dd>
              <dt class="col-sm-4">{% translate "Номер дела" %}</dt>
              <dd class="col-sm-8" id="wezwanieParsedCaseNumber">—</dd>
              <dt class="col-sm-4">{% translate "Дата отпечатков" %}</dt>
              <dd class="col-sm-8" id="wezwanieParsedFingerprintsDate">—</dd>
              <dt class="col-sm-4">{% translate "Дата децизии" %}</dt>
              <dd class="col-sm-8" id="wezwanieParsedDecisionDate">—</dd>
            </dl>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex gap-2 w-100 justify-content-end" id="uploadDocumentActions">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% translate "Отмена" %}</button>
            <button type="submit" class="btn btn-primary" id="uploadDocumentSubmitButton">{% translate "Сохранить" %}</button>
            <button type="submit" class="btn btn-primary d-none" id="wezwanieParseButton">{% translate "Распознать wezwanie" %}</button>
          </div>
          <div class="d-flex gap-2 w-100 justify-content-end d-none" id="wezwanieConfirmActions">
            <button type="button" class="btn btn-outline-secondary" id="wezwanieCancelButton"
              data-bs-dismiss="modal">{% translate "Отмена" %}</button>
            <button type="button" class="btn btn-primary" id="wezwanieConfirmButton">{% translate "Подтвердить" %}</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
