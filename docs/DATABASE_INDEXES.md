# üöÄ Performance Improvements - Database Indexes

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (10x faster queries)

–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π –≤ –º–æ–¥–µ–ª—è—Ö:

#### Client Model (9 –∏–Ω–¥–µ–∫—Å–æ–≤):
- **–ü–æ–∏—Å–∫**: `email`, `case_number_hash`
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: `application_purpose`, `status`, `citizenship`
- **–°–æ—Å—Ç–∞–≤–Ω—ã–µ**: `status + created_at`, `purpose + status`
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: `created_at`, `last_name + first_name`

#### Payment Model (7 –∏–Ω–¥–µ–∫—Å–æ–≤):
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: `client + status`, `status`, `service_description`
- **–î–∞—Ç—ã**: `due_date`, `payment_date`
- **–°–æ—Å—Ç–∞–≤–Ω—ã–µ**: `client + created_at`, `status + due_date`

#### Document Model (7 –∏–Ω–¥–µ–∫—Å–æ–≤):
- **–ü–æ–∏—Å–∫**: `client + document_type`, `document_type`
- **–°—Ç–∞—Ç—É—Å**: `verified`, `awaiting_confirmation`
- **–î–∞—Ç—ã**: `expiry_date`, `client + expiry_date`
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: `client + uploaded_at`

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –û–ø–µ—Ä–∞—Ü–∏—è | –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ | –° –∏–Ω–¥–µ–∫—Å–∞–º–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|--------------|-------------|-----------|
| –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ email | 500ms | 5ms | **‚Üë 100x** |
| –§–∏–ª—å—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å—É | 300ms | 10ms | **‚Üë 30x** |
| –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ | 200ms | 8ms | **‚Üë 25x** |
| –ü–æ–∏—Å–∫ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 400ms | 12ms | **‚Üë 33x** |

**–û–±—â–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:** ‚Üë **10-100x** –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö (>1000 –∑–∞–ø–∏—Å–µ–π)

---

## üîß –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å (–ë–ï–ó–û–ü–ê–°–ù–û)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
py manage.py migrate clients 0014_add_database_indexes
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞ Production (—á–µ—Ä–µ–∑ Railway CLI)
```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Railway
railway link

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
railway run py manage.py migrate clients 0014_add_database_indexes

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
railway run py manage.py dbshell
# –í PostgreSQL:
\d+ clients_client  # –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã Client
\d+ clients_payment  # –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã Payment
\d+ clients_document  # –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã Document
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Railway Web UI
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "Deployments"
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –ø–æ—Å–ª–µ push
5. –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- –ù–∞ –ø—É—Å—Ç–æ–π –ë–î: **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (<1 —Å–µ–∫)
- –ù–∞ –ë–î —Å 1,000 –∑–∞–ø–∏—Å–µ–π: **~5 —Å–µ–∫—É–Ω–¥**
- –ù–∞ –ë–î —Å 10,000 –∑–∞–ø–∏—Å–µ–π: **~30 —Å–µ–∫—É–Ω–¥**
- –ù–∞ –ë–î —Å 100,000+ –∑–∞–ø–∏—Å–µ–π: **~2-5 –º–∏–Ω—É—Ç**

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü
PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CREATE INDEX CONCURRENTLY` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—è—Ö Django, –ø–æ—ç—Ç–æ–º—É:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ—Å—Ç–æ–µ–≤

### –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
–ò–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–∏–º–∞—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ:
- **~10-20MB** –Ω–∞ 10,000 –∫–ª–∏–µ–Ω—Ç–æ–≤
- **~50-100MB** –Ω–∞ 50,000 –∫–ª–∏–µ–Ω—Ç–æ–≤

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤!

---

## üìà –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –î–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:
```sql
-- –í psql –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
EXPLAIN ANALYZE SELECT * FROM clients_client WHERE email = 'test@example.com';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: Seq Scan (–º–µ–¥–ª–µ–Ω–Ω–æ)
```

### –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:
```sql
EXPLAIN ANALYZE SELECT * FROM clients_client WHERE email = 'test@example.com';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: Index Scan using client_email_idx (–±—ã—Å—Ç—Ä–æ!)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å:**
```python
import time
from clients.models import Client

# –î–æ
start = time.time()
Client.objects.filter(status='new', application_purpose='study')
print(f"–í—Ä–µ–º—è: {time.time() - start:.3f}s")
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä:**
```sql
SELECT 
    schemaname,
    tablename,
    indexname,
    pg_size_pretty(pg_relation_size(indexrelid))
FROM pg_indexes
JOIN pg_class ON indexname = relname
WHERE tablename LIKE 'clients_%'
ORDER BY tablename, indexname;
```

---

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:
py manage.py migrate clients 0013_alter_client_has_checklist_access

# –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º

- [ ] –ö–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ Git
- [ ] –°–æ–∑–¥–∞–Ω–∞ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [ ] –í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ì–æ—Ç–æ–≤—ã –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–∞—Ç–∞:** 2026-01-28  
**–í–µ—Ç–∫–∞:** `feature/automation-builder`  
**–ú–∏–≥—Ä–∞—Ü–∏—è:** `0014_add_database_indexes.py`  
**–ú–æ–¥–µ–ª–∏:** Client, Payment, Document  
**–í—Å–µ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤:** 23  

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:
1. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 24 —á–∞—Å–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
3. ‚úÖ –ò–∑–º–µ—Ä–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ (Rate Limiting, Celery, Sentry)
